<main class="app-container" [class.drag-over]="isDragOver">
  <!-- Header -->
  <header class="header">
    <div class="logo">
      <svg class="logo-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span class="logo-text">Kafka Publisher</span>
    </div>
    <button class="btn btn-sm" (click)="showSettings = !showSettings">
      <svg class="icon" viewBox="0 0 24 24" fill="none">
        <path d="M12 15C13.6569 15 15 13.6569 15 12C15 10.3431 13.6569 9 12 9C10.3431 9 9 10.3431 9 12C9 13.6569 10.3431 15 12 15Z" stroke="currentColor" stroke-width="2"/>
        <path d="M19.4 15C19.2 15.3 19.1 15.7 19.2 16L19.9 17.2C20.1 17.5 20 17.9 19.7 18.1L18.1 19.7C17.9 19.9 17.5 20 17.2 19.8L16 19.1C15.7 19 15.3 19 15 19.2L14.8 19.2C14.5 19.3 14.2 19.6 14.1 19.9L13.8 21.2C13.7 21.6 13.4 21.9 13 21.9H10.9C10.5 21.9 10.2 21.6 10.1 21.2L9.8 19.9C9.7 19.6 9.4 19.3 9.1 19.2L8.9 19.2C8.6 19.1 8.2 19.1 7.9 19.2L6.7 19.9C6.4 20.1 6 20 5.8 19.7L4.2 18.1C4 17.9 3.9 17.5 4.1 17.2L4.8 16C4.9 15.7 4.9 15.3 4.7 15L4.6 14.8C4.5 14.5 4.2 14.2 3.9 14.1L2.7 13.8C2.3 13.7 2 13.4 2 13V10.9C2 10.5 2.3 10.2 2.7 10.1L3.9 9.8C4.2 9.7 4.5 9.4 4.6 9.1L4.7 8.9C4.8 8.6 4.8 8.2 4.7 7.9L4 6.7C3.8 6.4 3.9 6 4.2 5.8L5.8 4.2C6 4 6.4 3.9 6.7 4.1L7.9 4.8C8.2 4.9 8.6 4.9 8.9 4.7L9.1 4.6C9.4 4.5 9.7 4.2 9.8 3.9L10.1 2.7C10.2 2.3 10.5 2 10.9 2H13C13.4 2 13.7 2.3 13.8 2.7L14.1 3.9C14.2 4.2 14.5 4.5 14.8 4.6L15 4.7C15.3 4.8 15.7 4.8 16 4.7L17.2 4C17.5 3.8 17.9 3.9 18.1 4.2L19.7 5.8C19.9 6 20 6.4 19.8 6.7L19.1 7.9C19 8.2 19 8.6 19.2 8.9L19.2 9.1C19.3 9.4 19.6 9.7 19.9 9.8L21.2 10.1C21.6 10.2 21.9 10.5 21.9 10.9V13C21.9 13.4 21.6 13.7 21.2 13.8L19.9 14.1C19.6 14.2 19.3 14.5 19.2 14.8L19.4 15Z" stroke="currentColor" stroke-width="2"/>
      </svg>
      Settings
    </button>
  </header>

  <!-- Settings Panel -->
  @if (showSettings) {
    <div class="settings-panel card animate-fade-in">
      <h2>Configuration</h2>
      <div class="settings-grid">
        <div class="form-group">
          <label for="broker">Broker Address</label>
          <input id="broker" class="input" [(ngModel)]="config.broker" placeholder="localhost:9092" />
        </div>
        <div class="form-group">
          <label for="topic">Topic</label>
          <input id="topic" class="input" [(ngModel)]="config.topic" placeholder="my-topic" />
        </div>
        <div class="form-group">
          <label for="clientId">Client ID</label>
          <input id="clientId" class="input" [(ngModel)]="config.client_id" placeholder="kafka-msg-publisher" />
        </div>
      </div>
      <div class="settings-actions">
        <button class="btn" (click)="testConnection()" [disabled]="isLoading">
          @if (isLoading) {
            <span class="spinner"></span>
          }
          Test Connection
        </button>
        @if (connectionStatus === 'connected') {
          <span class="badge badge-success">Connected</span>
        } @else if (connectionStatus === 'error') {
          <span class="badge badge-error">Failed</span>
        }
        <button class="btn btn-primary" (click)="saveConfig()">Save</button>
      </div>
    </div>
  }

  <!-- Main Content -->
  <div class="main-content">
    <!-- Config Display -->
    <section class="config-bar card">
      <div class="config-item">
        <span class="config-label">Server</span>
        <span class="config-value text-mono">{{ config.broker }}</span>
      </div>
      <div class="config-divider"></div>
      <div class="config-item">
        <span class="config-label">Topic</span>
        <span class="config-value text-mono">{{ config.topic }}</span>
      </div>
    </section>

    <!-- Message Input -->
    <section class="message-section card">
      <div class="message-header">
        <h2>Message</h2>
        <span class="drop-hint text-muted">Drop a file to load its content</span>
      </div>
      <textarea 
        class="textarea message-input"
        [(ngModel)]="messageContent"
        placeholder="Enter your message here or drop a file..."
        [class.drag-highlight]="isDragOver"
      ></textarea>
      <div class="message-actions">
        <span class="char-count text-muted">{{ messageContent.length }} characters</span>
        <button 
          class="btn btn-primary send-btn" 
          (click)="sendMessage()" 
          [disabled]="!messageContent.trim() || isSending"
        >
          @if (isSending) {
            <span class="spinner"></span>
            Sending...
          } @else {
            <svg class="icon" viewBox="0 0 24 24" fill="none">
              <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Send Message
          }
        </button>
      </div>
    </section>

    <!-- Message History -->
    <section class="history-section card">
      <div class="history-header">
        <h2>History</h2>
        @if (messages.length > 0) {
          <button class="btn btn-sm" (click)="clearHistory()">Clear</button>
        }
      </div>
      @if (messages.length === 0) {
        <div class="history-empty">
          <p class="text-muted">No messages sent yet</p>
        </div>
      } @else {
        <div class="history-list">
          @for (msg of messages; track msg.id) {
            <div class="history-item animate-fade-in">
              <div class="history-item-header">
                <span [class]="'badge badge-' + msg.status">{{ msg.status }}</span>
                <span class="history-time text-muted">{{ formatTime(msg.timestamp) }}</span>
              </div>
              <p class="history-content text-mono">{{ truncateMessage(msg.content) }}</p>
              @if (msg.errorMessage) {
                <p class="history-error">{{ msg.errorMessage }}</p>
              }
            </div>
          }
        </div>
      }
    </section>
  </div>

  <!-- Drag Overlay -->
  @if (isDragOver) {
    <div class="drag-overlay">
      <div class="drag-content">
        <svg class="drag-icon" viewBox="0 0 24 24" fill="none">
          <path d="M21 15V19C21 20.1 20.1 21 19 21H5C3.9 21 3 20.1 3 19V15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M17 8L12 3L7 8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 3V15" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <p>Drop file to load content</p>
      </div>
    </div>
  }
</main>
